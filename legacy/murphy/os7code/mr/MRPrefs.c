// Murphy's Revenge// (c)1997 Q Software / Dave Peck, All Rights Reserved// This source code is confidential and proprietary, and may not be reproduced// or utilized by anyone without the express written permission of Q Software.// File: MRPrefs.c// Auth: Dave Peck// Date: 7/20/97// Desc: code for handling user preferences// ----------------------------------------------------------------// Includes// ----------------------------------------------------------------#include "MRPrefs.h"// ----------------------------------------------------------------// Constants// ----------------------------------------------------------------#define kPrefsResType	'Mprf'#define kPrefsResID		128// ----------------------------------------------------------------// Data Structures// ----------------------------------------------------------------// ----------------------------------------------------------------// Global Data// ----------------------------------------------------------------MRPrefs global_prefs;// ----------------------------------------------------------------// Function Prototypes// ----------------------------------------------------------------// ----------------------------------------------------------------// Functions// ----------------------------------------------------------------void MRLoadPreferences() {	// preferences are stored in the players file.	// this is nice in case players want to change.	MRPlayersResFile();		if ( !MRResourceExists( kPrefsResType, kPrefsResID ) ) {		// create default prefs		global_prefs.upKey = '8';		global_prefs.downKey = '2';		global_prefs.leftKey = '4';		global_prefs.rightKey = '6';		global_prefs.pauseKey = '\t';		global_prefs.suicideKey = '\33';		global_prefs.specialKey = ' ';		global_prefs.musicVolume = 255;		global_prefs.soundVolume = 255;		global_prefs.screenSize = kPrefsNormalScreenSize;		global_prefs.interlacedMode = false;		global_prefs.progressScreen = false;		global_prefs.compatibleDraws = false;	} else {		MRPrefsHand thePrefs;				thePrefs = (MRPrefsHand) Get1Resource( kPrefsResType, kPrefsResID );		HLockHi( (Handle) thePrefs );		global_prefs = (**thePrefs);		HUnlock( (Handle) thePrefs );		ReleaseResource( (Handle) thePrefs );	}		MRRestoreResFile();	}void MRClosePreferences() {	MRPrefsHand thePrefs = (MRPrefsHand) DBG_NewHandleClear( sizeof( MRPrefs ) );		// just save the preferences.	MRPlayersResFile();		// set 'em	HLockHi( (Handle) thePrefs );	(**thePrefs) = global_prefs;		(void) MROverwriteResource( kPrefsResType, kPrefsResID,								(Handle) thePrefs, "User Preferences" );		ReleaseResource( (Handle) thePrefs );		MRRestoreResFile();}MRPrefs GetCurrentPrefs() {	return global_prefs;}void SetCurrentPrefs(MRPrefs newPrefs) {	global_prefs = newPrefs;}